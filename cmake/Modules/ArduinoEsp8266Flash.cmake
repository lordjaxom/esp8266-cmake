if("${ESP8266_FLASH}" STREQUAL "")
    message(FATAL_ERROR "ESP8266_FLASH is not set")
endif()

if("${ESP8266_FLASH}" MATCHES "^512[kK](0[kK]?)?")
    set(ESP8266_FLASH_SIZE "512K")
    set(ESP8266_FLASH_LAYOUT "512k0")
elseif("${ESP8266_FLASH}" MATCHES "512[kK]64[kK]")
    set(ESP8266_FLASH_SIZE "512K")
    set(ESP8266_FLASH_LAYOUT "512k64")
elseif("${ESP8266_FLASH}" MATCHES "512k128[kK]")
    set(ESP8266_FLASH_SIZE "512K")
    set(ESP8266_FLASH_LAYOUT "512k128")
elseif("${ESP8266_FLASH}" MATCHES "1[mM]64[kK]")
    set(ESP8266_FLASH_SIZE "1M")
    set(ESP8266_FLASH_LAYOUT "1m64")
elseif("${ESP8266_FLASH}" MATCHES "1[mM]128[kK]")
    set(ESP8266_FLASH_SIZE "1M")
    set(ESP8266_FLASH_LAYOUT "1m128")
elseif("${ESP8266_FLASH}" MATCHES "1[mM]144[kK]")
    set(ESP8266_FLASH_SIZE "1M")
    set(ESP8266_FLASH_LAYOUT "1m144")
elseif("${ESP8266_FLASH}" MATCHES "1[mM]160[kK]")
    set(ESP8266_FLASH_SIZE "1M")
    set(ESP8266_FLASH_LAYOUT "1m160")
elseif("${ESP8266_FLASH}" MATCHES "1[mM]192[kK]")
    set(ESP8266_FLASH_SIZE "1M")
    set(ESP8266_FLASH_LAYOUT "1m192")
elseif("${ESP8266_FLASH}" MATCHES "1[mM]256[kK]")
    set(ESP8266_FLASH_SIZE "1M")
    set(ESP8266_FLASH_LAYOUT "1m256")
elseif("${ESP8266_FLASH}" MATCHES "1[mM]512[kK]")
    set(ESP8266_FLASH_SIZE "1M")
    set(ESP8266_FLASH_LAYOUT "1m512")
elseif("${ESP8266_FLASH}" MATCHES "2[mM](0[kK]?)?")
    set(ESP8266_FLASH_SIZE "2M")
    set(ESP8266_FLASH_LAYOUT "2m")
elseif("${ESP8266_FLASH}" MATCHES "4[mM](0[kK]?)?")
    set(ESP8266_FLASH_SIZE "4M")
    set(ESP8266_FLASH_LAYOUT "4m")
elseif("${ESP8266_FLASH}" MATCHES "4[mM]1[mM]")
    set(ESP8266_FLASH_SIZE "4M")
    set(ESP8266_FLASH_LAYOUT "4m1m")
elseif("${ESP8266_FLASH}" MATCHES "8[mM](0[kK]?)?")
    set(ESP8266_FLASH_SIZE "8M")
    set(ESP8266_FLASH_LAYOUT "8m")
elseif("${ESP8266_FLASH}" MATCHES "16[mM](0[kK]?)?")
    set(ESP8266_FLASH_SIZE "16M")
    set(ESP8266_FLASH_LAYOUT "16m")
else()
    message(FATAL_ERROR "Unknown value ${ESP8266_FLASH} for ESP8266_FLASH")
endif()

message(STATUS "Using ESP8266_FLASH_LAYOUT ${ESP8266_FLASH_LAYOUT}")

set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -L\"${ARDUINO_ESP8266_DIR}/tools/sdk/ld\" -Teagle.flash.${ESP8266_FLASH_LAYOUT}.ld")